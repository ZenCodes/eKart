<link rel="import" href="../components/polymer/polymer.html" />
<link rel="import" href="../components/core-ajax/core-ajax.html" />
<link rel="import" href="../components/paper-button/paper-button.html" />
<link rel="import" href="../components/paper-input/paper-input.html" />
<polymer-element name="x-ajax">
    <template>
    <style>


       :host {
	          position: absolute;
	          width: 100%;
	          height: 100%;
	          box-sizing: border-box;
	        }
	        #core_card {
	          position: absolute;
	          width: 300px;
	          height: 570px;
	          border-radius: 2px;
	          box-shadow: rgba(0, 0, 0, 0.0980392) 0px 2px 4px, rgba(0, 0, 0, 0.0980392) 0px 0px 3px;
	          left: 150px;
	          top: 90px;
	          background-color: rgb(255, 255, 255);
	        }
	       #input {
	  	            border-radius: 2px;
	  	 		     border: 1px solid #706D6C;
	  	 		     width: 250px;
	  	             left:30px;
	  	         position: absolute;
	  	         box-shadow: rgba(0, 0, 0, 0.2) 0px 1px 1px;
	  	         height:30px;
	            }

	             #input1 {
	  		  		  	            border-radius: 2px;
	  		  		  	 		     border: 1px solid #706D6C;
	  		  		  	 		     width: 250px;
	  		  		  	             left:30px;
	  		  		  	         position: absolute;
	  		  		  	         box-shadow: rgba(0, 0, 0, 0.2) 0px 1px 1px;
	  		  		  	         height:30px;

	            }
	            #input2 {
	  		  	            border-radius: 2px;
	  		  	 		     border: 1px solid #706D6C;
	  		  	 		     width: 250px;
	  		  	             left:30px;
	  		  	         position: absolute;
	  		  	         box-shadow: rgba(0, 0, 0, 0.2) 0px 1px 1px;
	  		  	         height:30px;

	            }
	            #input3 {
	  		  		  	            border-radius: 2px;
	  		  		  	 		     border: 1px solid #706D6C;
	  		  		  	 		     width: 250px;
	  		  		  	             left:30px;
	  		  		  	         position: absolute;
	  		  		  	         box-shadow: rgba(0, 0, 0, 0.2) 0px 1px 1px;
	  		  		  	         height:30px;
	            }
	            #input4 {
	  		  	            border-radius: 2px;
	  		  	 		     border: 1px solid #706D6C;
	  		  	 		     width: 250px;
	  		  	             left:30px;
	  		  	         position: absolute;
	  		  	         box-shadow: rgba(0, 0, 0, 0.2) 0px 1px 1px;
	  		  	         height:30px;
	            }
	            #input5 {
	  		  	            border-radius: 2px;
	  		  	 		     border: 1px solid #706D6C;
	  		  	 		     width: 250px;
	  		  	             left:30px;
	  		  	         position: absolute;
	  		  	         box-shadow: rgba(0, 0, 0, 0.2) 0px 1px 1px;
	  		  	         height:30px;
          }
           #reg
		        {
		         position:absolute;
		        font-size : 25px;
		        font-weight:bold;
		        text-align:center;
		        top:7px;
		        left:30px;
      }
       #div
	            {
	             padding:30px;
          }
          #paper_button {
		             background-color: rgb(242, 172, 77);
		             position:absolute;
		  		   		          left:105px;
		  		   				  			top:510px;
		  		   				          width: 170px;
		  		   				  			   padding: 5px 10px;
		  		   				  			   -webkit-border-radius: 8px;
		  		   				  			   -moz-border-radius: 8px;
		  		   				  			   border-radius: 8px;
		  		   				  			   -webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;
		  		   				  			   -moz-box-shadow: rgba(0,0,0,1) 0 1px 0;
		  		   				  			   box-shadow: rgba(0,0,0,1) 0 1px 0;
		  		   				  			   text-shadow: rgba(0,0,0,.4) 0 1px 0;
		  		   				  			   color: white;
		  		   				  			   font-size: 12px;
		  		   				  			   font-family: Georgia, serif;
		  		   				  			   text-decoration: none;
		  		      vertical-align: middle;
		  		   		           height:40px;

		  		            border: 1px solid #706D6C;





      }

    </style>

   <core-card id="core_card" layout vertical>
    <core-label id="reg" >Registered Here</core-label><br>
         <div id="div" layout  horizontal>
         <core-label id="name" >Name*</core-label><br>
		  <input id="input" value="{{name}}" label="{{Username}}" placeholder="Name" is="core-input">
        </div>
        <div id="div" layout  horizontal>
		  <core-label id="Mobile" >Mobile*</core-label><br>
		  <input id="input1" value="{{phone}}" label="{{PhoneNo}}" placeholder="Mobile Number" is="core-input">
  </div>
  <div id="div" layout  horizontal>
    <core-label id="Email" >Email*</core-label><br>
    <input id="input2" value="{{email}}" label="{{Email}}" placeholder="Email" is="core-input">
  </div>
  <div id="div" layout  horizontal>
      <core-label id="Referrer" >Referrer(Optional)</core-label><br>
      <input id="input3" value="{{ref}}" label="{{Ref}}" placeholder="Referrer" is="core-input">
  </div>
  <div id="div" layout  horizontal>
        <core-label id="pass" >Password*</core-label><br>
        <input id="input4" value="{{pass}}"  label="{{Password}}" placeholder="Password" is="core-input">
  </div>

  <div id="div" layout  horizontal>
        <core-label id="conpass" >Confirm Password*</core-label><br>
        <input id="input5" value="{{conpass}}"  label="{{ConPassword}}" placeholder="Password" is="core-input">
  </div>

         <paper-button id="paper_button" on-click="{{clickEventt}}">Save & Continue</paper-button>
         <!--<paper-button id="paper_button1">SignIn</paper-button>-->
    </core-card>
         <core-ajax id="ajax" auto="false" method="POST" handleAs="json" contentType="application/json" url="http://hotelapp.iriscouch.com/websitelogin/"
		   body='{"Register":[{"username":"{{uname}}","phone":"{{uphone}}","email":"{{uemail}}","ref":"{{uref}}","password":"{{upass}}","conpassword":"{{uconpass}}"}]}'>
    	 </core-ajax>
<core-ajax id="rajax"
      auto="false"

      url="http://hotelapp.iriscouch.com/websitelogin/_design/user/_view/userpwd?key={{n}}"
      on-core-response="{{htlsLoaded}}"
      handleAs="json">
    </core-ajax>
    </template>

    <script>
        Polymer({
            ready:function()
            {

            this.htls=[];


            },

            htlsLoaded:function()
            {
            	var chk=0;
            this.htls = this.$.rajax.response;
            //alert(JSON.stringify(this.htls.rows));
			            var arrlen=this.htls.rows.length;


						//alert("arrlen: "+arrlen+"  "+chk);
						if(arrlen==0)
						{
						ff2=1;
						//alert("yes");
						}
						else
						{
                        ff2=0;
						//alert("no");
                        }
                        localStorage.setItem("regflag",ff2);

                        if(localStorage.getItem("regflag")==1&&localStorage.getItem("nnflag")==1)
														{
														//alert("do well");
													    this.uname=this.name;
													    this.uphone=this.phone;
													    this.uemail=this.email;
													    this.uref=this.ref;
														this.upass=this.pass;
														this.uconpass=this.conpass;
														this.$.ajax.go();
														alert("Registered successfully...");
														}
														else
												        {
														alert("Try another name");

														}

            },
            clickEventt: function(event, detail, sender)
            {
                      this.Username="Username";
			            this.PhoneNo="Phoneno";
			             this.Email="Email";
			             this.ref="Ref";
			            this.Password="Password";
			             this.ConPassword="ConPassword";

            this.n=JSON.stringify(this.name);

             this.$.rajax.go();
            if(this.name==null||this.name==""){
			this.Username="valid username required";
			}

			if(this.pass==null||this.pass==""){
			this.Password="valid password required";
			}
			if(this.pass!=this.conpass){
						this.ConPassword="Mismatching Password";
			}
			if(this.email==null||this.email==""){
			this.Email="valid email required";
			}
			if(this.phone==null||this.phone==""){
			this.PhoneNo="valid phone no required";
			}
			var f1=0;
			var f2=0;
			var f3=0;


			var paswd=/^(?=.*[0-9])(?=.*[!@#$%^&*])[a-zA-Z0-9!@#$%^&*]{5,16}$/;
					  if(!(this.pass.match(paswd)))
					  {
					  this.name="";

					  this.pass="";
			          this.Password="should be alphanumeric";
					  }
					  else
					  {
					  f3++;
					  }

			var phoneno = /^\d{10}$/;
			if(!(this.phone.match(phoneno)))
		    {
		    this.phone="";
			this.PhoneNo="valid phone no required";
			}
			else
			{
			f1=1;
			}


			var mailformat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
			if(!(this.email.match(mailformat)))
			{
			this.email="";
			this.Email="valid email required";
            }
            else
            {
            f2=1;
            }



 if(this.name!=null && this.name!="" && this.pass!=null && this.pass!="" && this.email!=null && this.email!="" && this.pass!=this.conpass && this.phone!=null && this.phone!="" && f1==1 && f2==1 && f3==1)
						        {

						        localStorage.setItem("nnflag",1);
								}
								else
								{
								localStorage.setItem("nnflag",0);
								alert("all fields must be filled out");
								}

if(this.pass!=this.conpass)

{
alert("fail");
}



		        }

        });

    </script>
</polymer-element>