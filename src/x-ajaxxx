<link rel="import" href="../components/polymer/polymer.html" />
<link rel="import" href="../components/core-ajax/core-ajax.html" />
<link rel="import" href="../components/paper-button/paper-button.html" />
<link rel="import" href="../components/paper-input/paper-input.html" />
<polymer-element name="x-ajax">
    <template>
    <style>
    :host {
        position: absolute;
        width: 100%;
        height: 100%;
        box-sizing: border-box;
        background-color: rgb(192, 192, 192);
      }
      #section {
        left: 550px;
        top: 500px;
        position: absolute;
      }
      #core_card {
        position: absolute;
        width: 300px;
        height: 400px;
        border-radius: 2px;
        box-shadow: rgba(0, 0, 0, 0.0980392) 0px 2px 4px, rgba(0, 0, 0, 0.0980392) 0px 0px 3px;
        left: 500px;
        top: 50px;
        background-color: rgb(255, 255, 255);
      }
      #paper_button {
        top: 20px;
        width: 110px;
        background-color: rgb(86, 73, 237);
        left: 10px;
      }
      #paper_button1 {
		top: 30px;
	          width: 200px;
	          left: 8px;
	          //background-color: rgb(86, 73, 237);

      }

      #paper_input {
        width: 200px;
      }
      #paper_input1 {
        width: 200px;
      }
      #paper_input2 {
        width: 200px;
      }
      #paper_input3 {
        width: 200px;
      }
      #paper_input4 {
        width: 200px;
      }
#paper_item1 {

        top: 10px;

      }

    </style>

    <core-card id="core_card" layout vertical center center-justified>
         <paper-item id="paper_item1" icon="settings" label="Item">REGISTRATION</paper-item>
         <paper-input label="{{Username}}" value="{{name}}" id="paper_input"></paper-input>
		 <paper-input type="password" label="{{Password}}" value="{{pass}}" id="paper_input1"></paper-input>
         <paper-input label="{{Email}}" id="paper_input3" value="{{email}}"></paper-input>
         <paper-input label="{{PhoneNo}}" id="paper_input4" value="{{phone}}"></paper-input>
         <paper-button id="paper_button" on-click="{{clickEvent}}">SignUp</paper-button>
         <paper-button id="paper_button1" on-click="{{clickEventt}}">SignIn Here</paper-button>
         <!--<paper-button id="paper_button1">SignIn</paper-button>-->
    </core-card>
         <core-ajax id="ajax" auto="false" method="POST" handleAs="json" contentType="application/json" url="http://hotelapp.iriscouch.com/websitelogin/"
		   body='{"username":"{{uname}}","password":"{{upass}}","email":"{{uemail}}","phone":"{{uphone}}"}'>
    	 </core-ajax>
<core-ajax id="rajax"
      auto="false"

      url="http://hotelapp.iriscouch.com/websitelogin/_design/user/_view/userpwd?key={{n}}"
      on-core-response="{{htlsLoaded}}"
      handleAs="json">
    </core-ajax>
    </template>

    <script>
        Polymer({
            ready:function()
            {

            this.htls=[];
            this.Username="Username";
            this.Password="Password";
            this.Email="Email";
            this.PhoneNo="Phone no";
            },
clickEventt: function()
{
 window.location.href="index1.html";
},
            htlsLoaded:function()
            {
            	var chk=0;
            this.htls = this.$.rajax.response;
            //alert(JSON.stringify(this.htls.rows));
			            var arrlen=this.htls.rows.length;


						//alert("arrlen: "+arrlen+"  "+chk);
						if(arrlen==0)
						{
						ff2=1;
						//alert("yes");
						}
						else
						{
                        ff2=0;
						//alert("no");
                        }
                        localStorage.setItem("regflag",ff2);

                        if(localStorage.getItem("regflag")==1&&localStorage.getItem("nnflag")==1)
														{
														//alert("do well");
													    this.uname=this.name;
														this.upass=this.pass;
														this.uemail=this.email;
														this.uphone=this.phone;
														this.$.ajax.go();
														alert("Registered successfully...");
														}
														else
												        {
														alert("Try another name");

														}

            },
            clickEvent: function(event, detail, sender){

            this.n=JSON.stringify(this.name);

             this.$.rajax.go();
            if(this.name==null||this.name==""){
			this.Username="valid username required";
			}

			if(this.pass==null||this.pass==""){
			this.Password="valid password required";
			}
			if(this.email==null||this.email==""){
			this.Email="valid email required";
			}
			if(this.phone==null||this.phone==""){
			this.PhoneNo="valid phone no required";
			}
			var f1=0;
			var f2=0;
			var f3=0;


			var paswd=/^(?=.*[0-9])(?=.*[!@#$%^&*])[a-zA-Z0-9!@#$%^&*]{5,16}$/;
					  if(!(this.pass.match(paswd)))
					  {
					  this.name="";

					  this.pass="";
			          this.Password="should be alphanumeric";
					  }
					  else
					  {
					  f3++;
					  }

			var phoneno = /^\d{10}$/;
			if(!(this.phone.match(phoneno)))
		    {
		    this.phone="";
			this.PhoneNo="valid phone no required";
			}
			else
			{
			f1=1;
			}


			var mailformat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
			if(!(this.email.match(mailformat)))
			{
			this.email="";
			this.Email="valid email required";
            }
            else
            {
            f2=1;
            }



 if(this.name!=null && this.name!="" && this.pass!=null && this.pass!="" && this.email!=null && this.email!="" && this.phone!=null && this.phone!="" && f1==1 && f2==1 && f3==1)
						        {
						        localStorage.setItem("nnflag",1);
								}
								else
								{
								localStorage.setItem("nnflag",0);
								alert("all fields must be filled out");
								}




		        }

        });

    </script>
</polymer-element>